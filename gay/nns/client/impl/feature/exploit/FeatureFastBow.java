package gay.nns.client.impl.feature.exploit;

import gay.nns.client.api.event.interfaces.Subscribe;
import gay.nns.client.api.feature.AbstractFeature;
import gay.nns.client.api.feature.enums.FeatureCategory;
import gay.nns.client.api.feature.interfaces.FeatureInfo;
import gay.nns.client.api.setting.annotations.Serialize;
import gay.nns.client.api.setting.annotations.Slider;
import gay.nns.client.impl.event.player.UpdateEvent;
import gay.nns.client.impl.event.render.Render2DEvent;
import gay.nns.client.util.IMinecraft;
import gay.nns.client.util.math.TimerUtil;
import net.minecraft.item.ItemBow;
import net.minecraft.network.play.client.C03PacketPlayer;

@FeatureInfo(name = "Fast_Bow", description = "Shoots arrows faster", category = FeatureCategory.EXPLOIT)
public class FeatureFastBow extends AbstractFeature {

	@Serialize(name = "Delay")
	@Slider(min = 0.0, max = 1000.0, increment = 25.0)
	public double delay = 0.0;

	private final TimerUtil timer = new TimerUtil();

	public FeatureFastBow() {
		super();
	}

	@Override
	protected void onEnable() {
		super.onEnable();
	}

	@Override
	protected void onDisable() {
		super.onDisable();
	}

	@Subscribe
	public void onRender(final Render2DEvent render2DEvent) {
		this.setSuffix(String.valueOf(delay));
	}

	@Subscribe
	public void onUpdate(final UpdateEvent updateEvent) {
		if (IMinecraft.mc.thePlayer.getHeldItem() != null && IMinecraft.mc.thePlayer.getHeldItem().getItem() instanceof ItemBow && IMinecraft.mc.thePlayer.isUsingItem()) {
			if (timer.hasTimeElapsed((long) delay)) {
				for (int i = 0; i < 20; i++) {
					IMinecraft.mc.rightClickDelayTimer = 0;
					IMinecraft.mc.thePlayer.sendQueue.addToSendQueue(new C03PacketPlayer.C06PacketPlayerPosLook(IMinecraft.mc.thePlayer.posX, IMinecraft.mc.thePlayer.posY, IMinecraft.mc.thePlayer.posZ, IMinecraft.mc.thePlayer.rotationYaw, IMinecraft.mc.thePlayer.rotationPitch, IMinecraft.mc.thePlayer.onGround));
				}
				IMinecraft.mc.playerController.onStoppedUsingItem(IMinecraft.mc.thePlayer);
				timer.reset();
			}
		} else {
			IMinecraft.mc.rightClickDelayTimer = 0;
		}
	}

}
